# ğŸ—ï¸ Notification Service - Architecture

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API Gateway / Client                      â”‚
â”‚                     (NestJS, Express, etc.)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ gRPC Request (HTTP/2)
                            â”‚ + Metadata (auth, request-id)
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Notification Service                          â”‚
â”‚                         (Port 50051)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚           GrpcAuthInterceptor (Middleware)             â”‚      â”‚
â”‚  â”‚  â€¢ Check authorization token                           â”‚      â”‚
â”‚  â”‚  â€¢ Validate x-service-id                               â”‚      â”‚
â”‚  â”‚  â€¢ Log x-request-id                                    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                           â”‚                                       â”‚
â”‚                           â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         NotificationController (@Controller)           â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚  @GrpcMethod('SendNotification')                       â”‚      â”‚
â”‚  â”‚  @GrpcMethod('SendBatchNotifications')                 â”‚      â”‚
â”‚  â”‚  @GrpcMethod('GetNotificationStatus')                  â”‚      â”‚
â”‚  â”‚  @GrpcMethod('HealthCheck')                            â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                           â”‚                                       â”‚
â”‚                           â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚           NotificationService (Business Logic)         â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚  â€¢ processNotification()                               â”‚      â”‚
â”‚  â”‚  â€¢ sendNotification()                                  â”‚      â”‚
â”‚  â”‚  â€¢ sendBatchNotifications()                            â”‚      â”‚
â”‚  â”‚  â€¢ getNotificationStatus()                             â”‚      â”‚
â”‚  â”‚  â€¢ In-memory storage (Map)                             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                           â”‚                                       â”‚
â”‚                           â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚            GrpcExceptionFilter (Error Handler)         â”‚      â”‚
â”‚  â”‚  â€¢ HTTP â†’ gRPC status mapping                          â”‚      â”‚
â”‚  â”‚  â€¢ Error logging                                       â”‚      â”‚
â”‚  â”‚  â€¢ Structured error response                           â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Request Processing Flow

```
Client Request
     â”‚
     â”œâ”€â–º 1. gRPC Transport Layer (HTTP/2)
     â”‚      â€¢ TLS/mTLS handshake
     â”‚      â€¢ Protocol Buffers deserialization
     â”‚
     â”œâ”€â–º 2. GrpcAuthInterceptor
     â”‚      â€¢ Extract metadata
     â”‚      â€¢ Validate auth token
     â”‚      â€¢ Log request
     â”‚
     â”œâ”€â–º 3. Controller (@GrpcMethod)
     â”‚      â€¢ Route to correct method
     â”‚      â€¢ DTO validation (class-validator)
     â”‚
     â”œâ”€â–º 4. Service (Business Logic)
     â”‚      â€¢ Process notification
     â”‚      â€¢ Generate UUID
     â”‚      â€¢ Store in memory/DB
     â”‚      â€¢ Send via provider (EMAIL/SMS/PUSH)
     â”‚
     â”œâ”€â–º 5. Response
     â”‚      â€¢ Protocol Buffers serialization
     â”‚      â€¢ Return to client
     â”‚
     â””â”€â–º 6. Error Handling (if error)
            â€¢ GrpcExceptionFilter
            â€¢ Map to gRPC status code
            â€¢ Structured error response
```

## Notification Types

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Notification Types                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  ğŸ“§ EMAIL                                             â”‚
â”‚     â€¢ Welcome emails                                 â”‚
â”‚     â€¢ Password reset                                 â”‚
â”‚     â€¢ Newsletters                                    â”‚
â”‚     â€¢ Transactional emails                           â”‚
â”‚     â””â”€â–º Providers: SendGrid, AWS SES, SMTP          â”‚
â”‚                                                       â”‚
â”‚  ğŸ“± SMS                                               â”‚
â”‚     â€¢ OTP codes                                      â”‚
â”‚     â€¢ Alerts                                         â”‚
â”‚     â€¢ Verification codes                             â”‚
â”‚     â””â”€â–º Providers: Twilio, AWS SNS                  â”‚
â”‚                                                       â”‚
â”‚  ğŸ”” PUSH                                              â”‚
â”‚     â€¢ Mobile notifications                           â”‚
â”‚     â€¢ Desktop notifications                          â”‚
â”‚     â€¢ Real-time alerts                               â”‚
â”‚     â””â”€â–º Providers: FCM, APNs                        â”‚
â”‚                                                       â”‚
â”‚  ğŸ”— WEBHOOK                                           â”‚
â”‚     â€¢ Third-party integrations                       â”‚
â”‚     â€¢ Event callbacks                                â”‚
â”‚     â€¢ API notifications                              â”‚
â”‚     â””â”€â–º HTTP POST to external URLs                  â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layers                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º Layer 1: Transport Security (mTLS)
         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   â”‚  â€¢ TLS 1.3 encryption                â”‚
         â”‚   â”‚  â€¢ Client certificate verification   â”‚
         â”‚   â”‚  â€¢ Server certificate verification   â”‚
         â”‚   â”‚  â€¢ CA-signed certificates            â”‚
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º Layer 2: Authentication (Metadata)
         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   â”‚  authorization: Bearer JWT           â”‚
         â”‚   â”‚  x-service-id: caller-service        â”‚
         â”‚   â”‚  x-request-id: trace-id              â”‚
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º Layer 3: Input Validation
         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   â”‚  â€¢ class-validator decorators        â”‚
         â”‚   â”‚  â€¢ Type checking (TypeScript)        â”‚
         â”‚   â”‚  â€¢ Enum validation                   â”‚
         â”‚   â”‚  â€¢ Range validation (Min/Max)        â”‚
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€â–º Layer 4: Rate Limiting (planned)
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚  â€¢ Per service limits                â”‚
             â”‚  â€¢ Per user limits                   â”‚
             â”‚  â€¢ Priority-based throttling         â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Priority Queue

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Priority Queue (planned)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  ğŸ”´ URGENT (Priority: 3)                         â”‚
â”‚     â”œâ”€â–º Immediate processing                    â”‚
â”‚     â”œâ”€â–º Timeout: 2s                             â”‚
â”‚     â””â”€â–º Retry: 5 times                          â”‚
â”‚                                                  â”‚
â”‚  ğŸŸ  HIGH (Priority: 2)                           â”‚
â”‚     â”œâ”€â–º Fast processing                         â”‚
â”‚     â”œâ”€â–º Timeout: 5s                             â”‚
â”‚     â””â”€â–º Retry: 3 times                          â”‚
â”‚                                                  â”‚
â”‚  ğŸŸ¡ NORMAL (Priority: 1)                         â”‚
â”‚     â”œâ”€â–º Standard processing                     â”‚
â”‚     â”œâ”€â–º Timeout: 10s                            â”‚
â”‚     â””â”€â–º Retry: 3 times                          â”‚
â”‚                                                  â”‚
â”‚  ğŸŸ¢ LOW (Priority: 0)                            â”‚
â”‚     â”œâ”€â–º Background processing                   â”‚
â”‚     â”œâ”€â–º Timeout: 30s                            â”‚
â”‚     â””â”€â–º Retry: 1 time                           â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow - SendNotification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ SendNotificationRequest {
       â”‚   event_id: "evt_123"
       â”‚   user_id: "user_456"
       â”‚   type: "EMAIL"
       â”‚   template_id: "welcome"
       â”‚   payload: {...}
       â”‚   priority: "HIGH"
       â”‚ }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Notification Service              â”‚
â”‚                                      â”‚
â”‚  1. Generate UUID                    â”‚
â”‚     notification_id = uuid()         â”‚
â”‚                                      â”‚
â”‚  2. Validate Input                   â”‚
â”‚     class-validator checks           â”‚
â”‚                                      â”‚
â”‚  3. Process Notification             â”‚
â”‚     â”œâ”€â–º Select provider (email)     â”‚
â”‚     â”œâ”€â–º Render template             â”‚
â”‚     â”œâ”€â–º Send via provider           â”‚
â”‚     â””â”€â–º Update status               â”‚
â”‚                                      â”‚
â”‚  4. Store State                      â”‚
â”‚     Map.set(notification_id, {      â”‚
â”‚       ...request,                    â”‚
â”‚       status: "SENT",                â”‚
â”‚       created_at: timestamp          â”‚
â”‚     })                               â”‚
â”‚                                      â”‚
â”‚  5. Return Response                  â”‚
â”‚     SendNotificationResponse {       â”‚
â”‚       success: true                  â”‚
â”‚       notification_id: "notif_abc"  â”‚
â”‚       status: "SENT"                 â”‚
â”‚       timestamp: 1703001234567       â”‚
â”‚     }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client     â”‚
â”‚  (Response)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Retry Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Retry Mechanism                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  Attempt 1 â”€â”€â–º Send â”€â”€â–º Success? â”€â”€â–º Return     â”‚
â”‚       â”‚                    â”‚                     â”‚
â”‚       â”‚                    â”‚ Failure             â”‚
â”‚       â”‚                    â–¼                     â”‚
â”‚       â”‚              Wait (backoff)              â”‚
â”‚       â”‚                    â”‚                     â”‚
â”‚       â–¼                    â”‚                     â”‚
â”‚  Attempt 2 â”€â”€â–º Send â”€â”€â–º Success? â”€â”€â–º Return     â”‚
â”‚       â”‚                    â”‚                     â”‚
â”‚       â”‚                    â”‚ Failure             â”‚
â”‚       â”‚                    â–¼                     â”‚
â”‚       â”‚              Wait (backoff)              â”‚
â”‚       â”‚                    â”‚                     â”‚
â”‚       â–¼                    â”‚                     â”‚
â”‚  Attempt 3 â”€â”€â–º Send â”€â”€â–º Success? â”€â”€â–º Return     â”‚
â”‚                            â”‚                     â”‚
â”‚                            â”‚ Failure             â”‚
â”‚                            â–¼                     â”‚
â”‚                    Mark as FAILED                â”‚
â”‚                    Store error details           â”‚
â”‚                    Return error response         â”‚
â”‚                                                  â”‚
â”‚  Exponential Backoff:                            â”‚
â”‚  â€¢ Attempt 1: immediate                          â”‚
â”‚  â€¢ Attempt 2: wait 1s                            â”‚
â”‚  â€¢ Attempt 3: wait 2s                            â”‚
â”‚  â€¢ Attempt 4: wait 4s                            â”‚
â”‚  â€¢ Attempt 5: wait 8s                            â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Docker Deployment                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚         Docker Compose / Docker Swarm             â”‚     â”‚
â”‚  â”‚                  Port: 50051                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚                                  â”‚
â”‚                          â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         Notification Service Container           â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  Image: notification-service:1.0.0               â”‚      â”‚
â”‚  â”‚  Port: 50051                                     â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  Environment:                                    â”‚      â”‚
â”‚  â”‚  â€¢ GRPC_PORT=50051                               â”‚      â”‚
â”‚  â”‚  â€¢ GRPC_USE_TLS=true                             â”‚      â”‚
â”‚  â”‚  â€¢ NODE_ENV=production                           â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  Volumes:                                        â”‚      â”‚
â”‚  â”‚  â€¢ ./certs:/app/certs                            â”‚      â”‚
â”‚  â”‚  â€¢ ./logs:/app/logs                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Microservices Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Gateway   â”‚
â”‚   (Port 3000)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP/REST
         â”‚ (from users)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        API Gateway Service          â”‚
â”‚    (NestJS with gRPC Client)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ gRPC (HTTP/2)
         â”‚ Port 50051
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                  â”‚
         â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Notification    â”‚          â”‚   Other Services      â”‚
â”‚     Service       â”‚          â”‚   (User, Order, etc.) â”‚
â”‚   (Port 50051)    â”‚          â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Future integrations
          â”‚
          â”œâ”€â–º Email Provider (SendGrid, SES)
          â”‚
          â”œâ”€â–º SMS Provider (Twilio, SNS)
          â”‚
          â”œâ”€â–º Push Provider (FCM, APNs)
          â”‚
          â””â”€â–º Message Queue (RabbitMQ, Redis)
```

## Notification Status Flow

```
PENDING â”€â”€â–º SENT â”€â”€â–º DELIVERED
   â”‚                    â”‚
   â”‚                    â”‚
   â”œâ”€â”€â–º RETRY â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
   â”‚               â”‚
   â”‚               â”‚
   â””â”€â”€â–º FAILED â—„â”€â”€â”€â”˜

PENDING:   Created, waiting to send
SENT:      Sent to provider
DELIVERED: Delivery confirmed
RETRY:     Retrying
FAILED:    Error, not delivered
```

## Observability Stack (Planned)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Observability Stack                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Logging (Winston/Pino)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  â€¢ Structured JSON logs                â”‚         â”‚
â”‚  â”‚  â€¢ Log levels: debug/info/warn/error   â”‚         â”‚
â”‚  â”‚  â€¢ Request/Response logging            â”‚         â”‚
â”‚  â”‚  â€¢ Error stack traces                  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                      â”‚
â”‚  Metrics (Prometheus)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  â€¢ Total requests                      â”‚         â”‚
â”‚  â”‚  â€¢ Success/failure rate                â”‚         â”‚
â”‚  â”‚  â€¢ Response time (histogram)           â”‚         â”‚
â”‚  â”‚  â€¢ Active connections (gauge)          â”‚         â”‚
â”‚  â”‚  â€¢ Queue depth                          â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                      â”‚
â”‚  Tracing (OpenTelemetry + Jaeger)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  â€¢ Distributed tracing                 â”‚         â”‚
â”‚  â”‚  â€¢ Span tracking                       â”‚         â”‚
â”‚  â”‚  â€¢ Service dependency map              â”‚         â”‚
â”‚  â”‚  â€¢ Latency analysis                    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                      â”‚
â”‚  Dashboards (Grafana)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  â€¢ Real-time metrics visualization     â”‚         â”‚
â”‚  â”‚  â€¢ Alerts and notifications            â”‚         â”‚
â”‚  â”‚  â€¢ SLA monitoring                      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This architecture provides:
- âœ… Scalability (Docker + Load Balancer)
- âœ… Security (mTLS + Auth)
- âœ… Reliability (Retry + Error Handling)
- âœ… Performance (gRPC + HTTP/2)
- âœ… Observability (Logging + Metrics + Tracing)

